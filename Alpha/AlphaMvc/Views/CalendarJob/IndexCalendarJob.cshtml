@{
    ViewBag.Title = "IndexCalendarJob";
}

<h2>Calendar Job</h2>

<link href="@Url.Content("~/Content/calendar/fullcalendar.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/calendar/fullcalendar.print.min.css")" rel="stylesheet" media="print" type="text/css" />
<script src="@Url.Content("~/Scripts/lib/moment.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/lib/jquery.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/calendar/fullcalendar.min.js")" type="text/javascript"></script>

<script>
function GetDetail(currentMonth) {
    //Set defaultDate
    var today = new Date();
    var dd = today.getDate();
    var mm = today.getMonth() + 1; //January is 0!
    var yyyy = today.getFullYear();
    if (dd < 10) {
        dd = '0' + dd
    }
    if (mm < 10) {
        mm = '0' + mm
    }
    today = yyyy + '-' + mm + '-' + dd;

    var dataObject = { CalendarMonth: currentMonth }
    $.ajax(
       {
           url: 'http://localhost:13131/api/CalendarJobOrder',
           type: 'GET',
           async: false,
           data: dataObject,
           datatype: 'json',
           success: function (data) {
               data = JSON.parse(data);
               var events = [];
               for (var i = 0; i < data.Table.length; i++) {
                   var EWorking = data.Table[i].EWorking.replace('T00:00:00', 'T23:59:00');
                   var TypeWorking = data.Table[i].TypeWorkingName.substr(0, 1);
                   events.push({
                       title: data.Table[i].JobNo + '(' + TypeWorking+')',
                       url: '/JobOrder/EditJobOrder?id=' + data.Table[i].ID,
                       start: data.Table[i].SWorking,
                       end: EWorking
                       ////id: data.Table[i].ID
                   });
               }
               $('#calendar').fullCalendar({
                   async: false,
                   header: {
                       left: 'prev,next',
                       center: 'title',
                       right: ''
                   },

                   defaultDate: today,
                   navLinks: true, // can click day/week names to navigate views
                   editable: true,
                   eventLimit: true, // allow "more" link when too many events
                   displayEventTime: false,
                   events: events
               });
           },
           error: function (msg) {
               alert(msg);
           }

       });
}
$(document).ready(function () {
    var currentDate = new Date();
    var currentMonth = currentDate.getMonth() + 1;
    GetDetail(currentMonth);
    $('#calendar').on('click', '.fc-next-button', function () {
        var currentMonth = $('#calendar').fullCalendar('getDate');
        currentMonth = parseInt(currentMonth.format('M'));
        GetDetail(currentMonth);
    });
    $('#calendar').on('click', '.fc-prev-button', function () {
        var currentMonth = $('#calendar').fullCalendar('getDate');
        currentMonth = parseInt(currentMonth.format('M'));
        //alert(currentMonth);
        GetDetail(currentMonth);
    });
});

</script>
<style>
    body {
        /*margin: 40px 10px;*/
        padding: 0;
        font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
        font-size: 14px;
    }

    #calendar {
        max-width: 800px;
        max-height: 550px;
        margin: 0 auto;
    }
</style>
<div id="calendar"></div>

