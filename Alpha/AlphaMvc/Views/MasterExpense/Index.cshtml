@{
    ViewBag.Title = "Index";
}

<h2>Master Expense</h2>
<link href="@Url.Content("~/Content/table/jquery-ui.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/jquery.dataTables.css")" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
<script src="@Url.Content("~/Scripts/EditableGrid/paging.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/editable/datagrid.css")" rel="stylesheet" type="text/css" />
<style>
    .paging-nav {
        text-align: right;
        padding-top: 2px;
    }

        .paging-nav a {
            margin: auto 1px;
            text-decoration: none;
            display: inline-block;
            padding: 1px 7px;
            background: #91b9e6;
            color: white;
            border-radius: 3px;
        }

        .paging-nav .selected-page {
            background: #187ed5;
            font-weight: bold;
        }

    .paging-nav,
    #tableData {
        width: 400px;
        margin: 0 auto;
        font-family: Arial, sans-serif;
    }
</style>
@* ------------------------------- Header -------------------------------*@
<table class="btnAdd">
    <tr>
        <td>
            <div class="topictd">List</div>
            <a href="/MasterExpense/Create"><img src="@Url.Content("~/images/btnAdd.png")" alt="IMAGES" /></a>
        </td>
    </tr>
</table>

@* ------------------------------- grid  -------------------------------*@
<table class="barattach-2">
    <tr>
        <td>

            <div class="topicattach-2">Search : <input id="searchInput" placeholder="Type To Filter"><br /></div>
        </td>
    </tr>
</table>

<div class="datagrid">
    <table>
        <thead>
            <tr>
                <th>No.</th>
                <th>รายละเอียด</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="result"></tbody>
    </table>
</div>

<ul class="form-style">
    <li>
        <input id="Del" type="Button" value="Del" />
    </li>
</ul>
<a href="#" id="Del"><img src="@Url.Content("~/Images/delete.png")" alt="IMAGES" /></a>
      @* ------------------------------- grid  -------------------------------*@

<script>
    $(document).ready(function () {
            //------------------------- Sorting ------------------------
            $('#tableData').paging({ limit: 5 });
            $('th').click(function () {
                var table = $(this).parents('table').eq(0)
                var rows = table.find('tr:gt(0)').toArray().sort(comparer($(this).index()))
                this.asc = !this.asc
                if (!this.asc) { rows = rows.reverse() }
                for (var i = 0; i < rows.length; i++) { table.append(rows[i]) }
            })
            function comparer(index) {
                return function (a, b) {
                    var valA = getCellValue(a, index), valB = getCellValue(b, index)
                    return $.isNumeric(valA) && $.isNumeric(valB) ? valA - valB : valA.localeCompare(valB)
                }
            }
            function getCellValue(row, index) { return $(row).children('td').eq(index).html() }
            
            //-------------------------filter------------------------
            $("#searchInput").keyup(function () {
                $("#result").find("tr").hide();
                var data = this.value.split(" ");
                var jo = $("#result").find("tr");
                $.each(data, function (i, v) {
                    jo = jo.filter("*:contains('" + v + "')");
                });
                jo.show();

            }).focus(function () {
                this.value = "";
                $(this).css({ "color": "black" });
                $(this).unbind('focus');
            }).css({ "color": "#C0C0C0" });
            //-------------------------filter------------------------

            $.ajax(
            {
                url: 'http://localhost:13131/api/MasterExpense/Get',
                type: 'GET',
                datatype: 'json',
                success: function (data) {
                    data = JSON.parse(data);
                    var html = '<tbody>';
                    for (var i = 0; i < data.Table.length; i++) {
                        html += '<tr>';
                        html += '<td>' + data.Table[i].ID + '</td>';
                        html += '<td>' + data.Table[i].Detail + '</td>';
                        html += '<td>';
                        html += '<a href="#" id="edit'+data.Table[i].ID+ '">'+ '<img src="@Url.Content("~/Images/edit.png")"/></a>';
                        html += '<a href="#" id="del' + data.Table[i].ID + '">' + '<img src="@Url.Content("~/Images/delete.png")" /></a>';
                        html += '</tr>';
                    }

                    html += '</tbody>';
                    alert(html);
                    document.getElementById("result").innerHTML = html;
                },
                error: function (msg) {
                    alert(msg)
                }
            });

            $("#Del").click(function () {
                var dataObject = { ID: 1 };
                $.ajax(
                {
                    url: 'http://localhost:13131/api/MasterExpense/Delete',
                    type: 'DELETE',
                    data: dataObject,
                    datatype: 'json',

                    success: function (result) {
                        console.log(url);
                        if (result.toString() == "Success") {
                            alert(result)
                        }
                        else {
                            alert(result)
                        }
                    },
                    error: function (msg) {
                        alert(msg)
                    }
                });
            });

        });
</script>


