@model AlphaMvc.Models.BDCModels
@{
    ViewBag.Title = "EditBDC";
}

<h2>BreakDown Cost Edit</h2>
<table>
    <tr>
        <td>
            @Html.ActionLink("Break Down Cost List", "IndexBDC")
        </td>
    </tr>
</table>
@*<br />*@
@* -------------------------------------- modal dialog-------------------------------- *@
<link href="@Url.Content("~/Content/Dialog/dialogstyle.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/Tab/easy-responsive-tabs.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/Tab/easyResponsiveTabs.js")" type="text/javascript"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link href="@Url.Content("~/Content/editable/tablestyle.css")" rel="stylesheet" type="text/css" />

<div class="modal fade" id="quotationDialog" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Quotation</h4>
            </div>
            <div class="modal-body">
                <table id="tblQuotation" class="table table-striped table-hover">
                    <thead class="bgthead">
                        <tr>
                            <th>No.</th>
                            <th>เลขที่ Quotation</th>
                            <th>รายละเอียด</th>
                            <th>ลูกค้า</th>
                            <th>ราคา</th>
                        </tr>
                    </thead>
                    <tbody id="quotationBody"></tbody>
                </table>
                @*<ul class="pagination pagination-lg pager" id="myPager"></ul>*@
            </div>
        </div>

    </div>
</div>

<div id="myModal">

    @using (Html.BeginForm())
    {
        <form>
            <ul class="form-style-1">
                <li>
                    <label class="btnnew">Doc Version</label>&nbsp;<img src="@Url.Content("~/images/btnNewVersion.jpg")" alt="IMAGES" class="btnimage-3" />
                </li>
                <li>
                    <input type="text" id="txtDocver" name="field1" class="field-select-small-2" placeholder="V1" disabled />
                </li>
                <li>
                    <label>ใบเสนอราคา<span class="required">*</span></label>
                    <input type="text" id="txtQuoNo" name="txtQuoNo" class="field-select-big" placeholder="ใบเสนอราคา" disabled />&nbsp;<a href="#" data-toggle="modal" data-target="#quotationDialog">
                        <img src="@Url.Content("~/Images/search-engine.png")" class="btnimage" />
                    </a>
                    <input type="hidden" id="hidQuoID" />
                </li>
            </ul>
            <ul class="form-style-1">
                <li>
                    <label class="label-big">ราคาขาย<span class="required">*</span></label>&nbsp;<label class="label-small">ราคาทุน<span class="required">*</span></label>
                    <input type="text" id="txtPrice" name="field1" class="field-divided" placeholder="ราคาขาย" />&nbsp;<input type="text" id="txtCost" name="field2" class="field-divided" placeholder="ราคาทุน" />
                </li>
                <li>
                    <label>กำไร<span class="required">*</span></label>
                    <input type="text" id="txtProfit" name="field1" class="field-divided" placeholder="กำไร" />
                </li>
            </ul>
            <ul class="form-style-1">
                <li>
                    <label>หมายเหตุ<span class="required">*</span></label>
                    <textarea name="field5" id="txtRemark" class="field-long field-textarea"></textarea>
                </li>
                <br />
            </ul>

            <table class="tabbar">
                <tr>
                    <td>
                        <div id="container">

                            <div id="parentHorizontalTab">
                                <ul class="resp-tabs-list hor_1">
                                    <li>Job Order</li>
                                </ul>
                                <div class="resp-tabs-container hor_1">
                                    <div>
                                        <div class="barattach-2">
                                            <a href="@Url.Action("CreateJobOrder", "JobOrder")" class="alink"><img src="@Url.Content("~/Images/btnAdd.png")" class="btnimage-2" /></a>
                                        </div>
                                        <div class="grigbar">
                                            <div class="myDIV">
                                                <table class="table table-striped">
                                                    <thead class="bgthead">
                                                        <tr>
                                                            <th>No.</th>
                                                            <th>Job No.</th>
                                                            <th>วันที่</th>
                                                            <th>ลูกค้า</th>
                                                            <th>เบอร์โทร</th>
                                                            <th class="hideANDseek">บุคคลติดต่อ</th>
                                                            <th class="hideANDseek">ผู้ประสานงาน</th>
                                                            <th class="hideANDseek">หมายเหตุ</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td>1</td>
                                                            <td>Order1</td>
                                                            <td>17/12/2017</td>
                                                            <td>บริษัท1</td>
                                                            <td>098xxxxxxx</td>
                                                            <td class="hideANDseek">บุคคลติดต่อ1</td>
                                                            <td class="hideANDseek">ผู้ประสานงาน1</td>
                                                            <td class="hideANDseek">หมายเหตุ1</td>
                                                            <td>
                                                                <a href="@Url.Action("Create", "JobOrder")">
                                                                    <img src="@Url.Content("~/Images/edit.png")" />
                                                                </a>
                                                                <a href="@Url.Action("Delete", "Trachnician")">
                                                                    <img src="@Url.Content("~/Images/delete.png")" />
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>2</td>
                                                            <td>Order2</td>
                                                            <td>17/12/2017</td>
                                                            <td>บริษัท2</td>
                                                            <td>098xxxxxxx</td>
                                                            <td class="hideANDseek">บุคคลติดต่อ2</td>
                                                            <td class="hideANDseek">ผู้ประสานงาน2</td>
                                                            <td class="hideANDseek">หมายเหตุ2</td>
                                                            <td>
                                                                <a href="@Url.Action("Create", "JobOrder")">
                                                                    <img src="@Url.Content("~/Images/edit.png")" />
                                                                </a>
                                                                <a href="@Url.Action("Delete", "Trachnician")">
                                                                    <img src="@Url.Content("~/Images/delete.png")" />
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>3</td>
                                                            <td>Order3</td>
                                                            <td>17/12/2017</td>
                                                            <td>บริษัท3</td>
                                                            <td>098xxxxxxx</td>
                                                            <td class="hideANDseek">บุคคลติดต่อ3</td>
                                                            <td class="hideANDseek">ผู้ประสานงาน3</td>
                                                            <td class="hideANDseek">หมายเหตุ3</td>
                                                            <td>
                                                                <a href="@Url.Action("Create", "JobOrder")">
                                                                    <img src="@Url.Content("~/Images/edit.png")" />
                                                                </a>
                                                                <a href="@Url.Action("Delete", "Trachnician")">
                                                                    <img src="@Url.Content("~/Images/delete.png")" />
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>4</td>
                                                            <td>Order4</td>
                                                            <td>17/12/2017</td>
                                                            <td>บริษัท4</td>
                                                            <td>098xxxxxxx</td>
                                                            <td class="hideANDseek">บุคคลติดต่อ4</td>
                                                            <td class="hideANDseek">ผู้ประสานงาน4</td>
                                                            <td class="hideANDseek">หมายเหตุ4</td>
                                                            <td>
                                                                <a href="@Url.Action("Create", "JobOrder")">
                                                                    <img src="@Url.Content("~/Images/edit.png")" />
                                                                </a>
                                                                <a href="@Url.Action("Delete", "Trachnician")">
                                                                    <img src="@Url.Content("~/Images/delete.png")" />
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>5</td>
                                                            <td>Order5</td>
                                                            <td>17/12/2017</td>
                                                            <td>บริษัท5</td>
                                                            <td>098xxxxxxx</td>
                                                            <td class="hideANDseek">บุคคลติดต่อ5</td>
                                                            <td class="hideANDseek">ผู้ประสานงาน5</td>
                                                            <td class="hideANDseek">หมายเหตุ5</td>
                                                            <td>
                                                                <a href="@Url.Action("Create", "JobOrder")">
                                                                    <img src="@Url.Content("~/Images/edit.png")" />
                                                                </a>
                                                                <a href="@Url.Action("Create", "JobOrder")">
                                                                    <img src="@Url.Content("~/Images/delete.png")" />
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>6</td>
                                                            <td>Order6</td>
                                                            <td>17/12/2017</td>
                                                            <td>บริษัท6</td>
                                                            <td>098xxxxxxx</td>
                                                            <td class="hideANDseek">บุคคลติดต่อ6</td>
                                                            <td class="hideANDseek">ผู้ประสานงาน6</td>
                                                            <td class="hideANDseek">หมายเหตุ6</td>
                                                            <td>
                                                                <a href="@Url.Action("Create", "JobOrder")">
                                                                    <img src="@Url.Content("~/Images/edit.png")" />
                                                                </a>
                                                                <a href="@Url.Action("Delete", "Trachnician")">
                                                                    <img src="@Url.Content("~/Images/delete.png")" />
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>7</td>
                                                            <td>Order7</td>
                                                            <td>17/12/2017</td>
                                                            <td>บริษัท7</td>
                                                            <td>098xxxxxxx</td>
                                                            <td class="hideANDseek">บุคคลติดต่อ7</td>
                                                            <td class="hideANDseek">ผู้ประสานงาน7</td>
                                                            <td class="hideANDseek">หมายเหตุ7</td>
                                                            <td>
                                                                <a href="@Url.Action("Create", "JobOrder")">
                                                                    <img src="@Url.Content("~/Images/edit.png")" />
                                                                </a>
                                                                <a href="@Url.Action("Delete", "Trachnician")">
                                                                    <img src="@Url.Content("~/Images/delete.png")" />
                                                                </a>
                                                            </td>
                                                        </tr>

                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
            <ul class="form-style-1">
                <li>
                    <input type="submit" value="Save" id="Update" />
                </li>
            </ul>
        </form>
    }
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $("#quotationBody").on("click", "tr", function (e) {
            $("#txtQuoNo").val($(this).find("td:eq(2)").text());
            $("#hidQuoID").val($(this).find("td:eq(1)").text());
        })

        $.ajax(
           {
               url: 'http://localhost:13131/api/Quotation',
               type: 'GET',
               datatype: 'json',
               success: function (data) {
                   data = JSON.parse(data);
                   var html = '';
                   for (var i = 0; i < data.Table.length; i++) {
                       html += '<tr>';
                       html += '<td data-dismiss="modal">' + data.Table[i].RowNum + '</td>';
                       html += '<td class="hidecolumn" data-dismiss="modal">' + data.Table[i].ID + '</td>';
                       html += '<td data-dismiss="modal">' + data.Table[i].QuoNo + '</td>';
                       html += '<td data-dismiss="modal">' + data.Table[i].Detail + '</td>';
                       html += '<td data-dismiss="modal">' + data.Table[i].Name + '</td>';
                       html += '<td data-dismiss="modal">' + data.Table[i].Price + '</td>';
                       html += '</tr>';
                   }
                   document.getElementById("quotationBody").innerHTML = html;
               },
               error: function (msg) {
                   alert(msg)
               }
           });

        var id= @Request.Params["id"];
        $.ajax(
       {
           url: 'http://localhost:13131/api/BDC/'+id,
           type: 'GET',
           datatype: 'json',
           success: function (data) {
               data = JSON.parse(data);
               $("#txtDocver").val(data.Table[0].Docver),$("#txtQuoNo").val(data.Table[0].QuoNo),$("#txtPrice").val(data.Table[0].Price)
               ,$("#txtCost").val(data.Table[0].Cost),$("#txtProfit").val(data.Table[0].Profit),$("#txtRemark").val(data.Table[0].Remark);
           },
           error: function (msg) {
               alert(msg);
           }

       });

        $("#Update").click(function () {
            var dataObject = { ID: @Request.Params["id"], Docver: 1, QuotationNo: $("#hidQuoID").val(), Price: $("#txtPrice").val(), Cost: $("#txtCost").val(),
                Profit: $("#txtProfit").val(), Remark: $("#txtRemark").val()};
            console.log(dataObject);
            $.ajax(
            {
                url: 'http://localhost:13131/api/BDC/PUT',
                type: 'PUT',
                data: dataObject,
                datatype: 'json',

                success: function (result) {
                    alert('Update is completed');
                    top.location.href = "/BDC/IndexBDC";
                }
                ,
                error: function (msg) {
                    alert(msg);
                    //top.location.href = "/ExpenseMaster/Index";
                }
            });
        });
    });
</script>
