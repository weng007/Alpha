@model AlphaMvc.Models.Product
@{
    ViewBag.Title = "CreateProducts";
}

<h2>
    Product Create
</h2>
@*<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">*@
<link href="@Url.Content("~/Content/bootstrap.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/editable/tablestyle.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/editable/tablestyle.css")" rel="stylesheet" type="text/css" />
<link href="@Url.Content("~/Content/fileInput/fileinput.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Scripts/fileInput/fileinput.js")" type="text/javascript"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" type="text/javascript"></script>

<style>
    table {
        background: #fbfbf1;
        width: 335px;
    }
    .btn-xs{
        padding: 1px 1px;
        width: 20px;
    }
</style>
<table>
    <tr>
        <td>
            <div class="linkstyle">@Html.ActionLink("Products List", "IndexProducts")</div>
        </td>
    </tr>
</table>
<div id="myModal">
    @using (Html.BeginForm())
    {
        <form>
            <ul class="form-style-1">
                <li>
                    <label>Products <span class="required">*</span></label>
                    <input type="text" id = "txtSerialNo" name="field1" class="field-divided" placeholder="Serial" />&nbsp;<input type="text" id = "txtMachineNo" name="field1" class="field-divided" placeholder="หมายเลขเครื่อง" />
                </li>
                <li>
                    <label>ประเภทสินค้า</label>
                    <select id="cmbProductType" name="cmbProductType" class="field-select" >
                    </select>
                    @*onchange="cmbProductType_Change()"*@
                </li>
                <li>
                    <input type="text" id = "txtBrand" name="field1" class="field-divided" placeholder="ยี่ห้อ" />&nbsp;<input type="text" id = "txtSize" name="field2" class="field-select-small" placeholder="ขนาด" />
                </li>
                <li>
                    <input type="text" id = "txtModel" name="field2" class="field-divided" placeholder="รุ่น" />&nbsp;<input type="text" id = "txtLifetime" name="field2" class="field-select-small-3" placeholder="อายุการใช้งาน" />&nbsp;<label>ปี</label>
                </li>
                <li>
                    <label class="label-big">รับเข้า</label>&nbsp;<label class="label-small">หน่วยนับ</label>
                </li>
                <li>
                    <input type="text" id = "dtReceiveDate" class="field-divided" placeholder="วันที่รับเข้า" />&nbsp;
                    <select id="cmbUnitWeight" name="cmbUnitWeight" class="field-select-small-2" >
                    </select>
                    @*onchange="cmbUnitWeight_Change()"*@
                </li>
                <li>
                    <label class="label-small">ยกมา</label>&nbsp;<label class="label-small-3">คงเหลือ</label>
                </li>
                <li>
                    <input type="text" id = "txtBalance" name="field1" class="field-select-small" placeholder="ยกมา" />&nbsp;<input type="text" id = "txtRemain" name="field2" class="field-select-small" placeholder="คงเหลือ" />
                </li>
                <li>
                    <label class="label-small-2">หาย</label>&nbsp;<label class="label-small-2">ซ่อม</label>&nbsp;<label class="label-small-2">ชำรุด</label>
                </li>
                <li>
                    <input type="text" id = "txtLost" name="field6" class="field-select-small" placeholder="หาย" disabled />&nbsp;<input type="text" id = "txtRepair" name="field7" class="field-select-small" placeholder="ซ่อม" disabled />&nbsp;<input type="text" id = "txtBreak" name="field8" class="field-select-small" placeholder="ชำรุด" disabled />
                </li>
            </ul>
            <ul class="form-style-1">
                <li>
                    @*<button class="imgbutton" id="img"></button>*@
                    @*<input id="photo" type="file" class="file" data-upload-url="#">*@

                    <input id="urlText" />
                    <input type="file" name="photo" id="photo" onchange="readURL(this);">
                    <img id="imgPreview" src="#" alt="your image" />

                </li>
                <li>
                    <label>หมายเหตุ<span class="required">*</span></label>
                    <textarea name="field5" id = "txtRemark" class="field-long field-textarea"></textarea>
                </li>
                <li>
                    <input type="submit" value="Save" id="Create"  />
                </li>
            </ul>
            <ul class="attachgrid">
                <li>
                    <table class="barattach">
                        <tr>
                            <td>
                                
                                <div class="topicattach"><a href="#"><img src="@Url.Content("~/Images/attachments2.png")" /></a></div>
                            </td>
                        </tr>
                    </table>
                    <table class="example-2" cellspacing="0">
                        <thead class="theader">
                            <tr>
                                <th>No.</th>
                                <th>File Name</th>
                                <th>Doc Type</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>File1</td>
                                <td>
                                    <select name="D1">
                                        <option value="volvo">ประเภท1</option>
                                        <option value="saab">ประเภท2</option>
                                        <option value="mercedes">ประเภท3</option>
                                        <option value="mercedes">ประเภท4</option>
                                    </select>
                                </td>
                                <td>
                                    <a href="@Url.Action("Delete", "Trachnician")">
                                        <img src="@Url.Content("~/Images/delete.png")" />
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>File2</td>
                                <td>
                                    <select name="D1">
                                        <option value="volvo">ประเภท1</option>
                                        <option value="saab">ประเภท2</option>
                                        <option value="mercedes">ประเภท3</option>
                                        <option value="mercedes">ประเภท4</option>
                                    </select>
                                </td>
                                <td>
                                    <a href="@Url.Action("Delete", "Trachnician")">
                                        <img src="@Url.Content("~/Images/delete.png")" />
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>File3</td>
                                <td>
                                    <select name="D1">
                                        <option value="volvo">ประเภท1</option>
                                        <option value="saab">ประเภท2</option>
                                        <option value="mercedes">ประเภท3</option>
                                        <option value="mercedes">ประเภท4</option>
                                    </select>
                                </td>
                                <td>
                                    <a href="@Url.Action("Delete", "Trachnician")">
                                        <img src="@Url.Content("~/Images/delete.png")" />
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>File4</td>
                                <td>
                                    <select name="D1">
                                        <option value="volvo">ประเภท1</option>
                                        <option value="saab">ประเภท2</option>
                                        <option value="mercedes">ประเภท3</option>
                                        <option value="mercedes">ประเภท4</option>
                                    </select>
                                </td>
                                <td>
                                    <a href="@Url.Action("Delete", "Trachnician")">
                                        <img src="@Url.Content("~/Images/delete.png")" />
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </li>
                <br />
            </ul>
</form>
    }
</div>

<script type="text/javascript">
    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#imgPreview')
                    .attr('src', e.target.result)
                    .width(100)
                    .height(120);
            };

            reader.readAsDataURL(input.files[0]);
        }
    }
    $(document).ready(function () {
        var dataObject = { typeID: '003' };
        $.ajax({
            url: 'http://localhost:13131/api/MasterService',
            type: 'GET',
            dataType: 'json',
            data: dataObject,
            success: function (data) {
                data = JSON.parse(data);
                $.each(data.Table, function (i) {
                    $('#cmbProductType').append($('<option></option>').val(data.Table[i].ID).html(data.Table[i].Detail));
                });
                $('#cmbProductType').find('option:first-child').attr('selected', true);

                //ProductTypeVal = $("#cmbProductType").find(":selected").val();
                
            },
            failure: function () {
                alert('Error');
            }
        });

        var dataObject = { typeID: '004' };
        $.ajax({
            url: 'http://localhost:13131/api/MasterService',
            type: 'GET',
            dataType: 'json',
            data: dataObject,
            success: function (data) {
                data = JSON.parse(data);
                $.each(data.Table, function (i) {
                    $('#cmbUnitWeight').append($('<option></option>').val(data.Table[i].ID).html(data.Table[i].Detail));
                });
                $('#cmbUnitWeight').find('option:first-child').attr('selected', true);

                //UnitWeightVal = $("#cmbUnitWeight").find(":selected").val();
                //console.log(UnitWeightVal);
            },
            failure: function () {
                alert('Error');
            }
        });

        $("#dtReceiveDate").datepicker();
        
    });
    function getBase64Image(imgElem) {
        // imgElem must be on the same server otherwise a cross-origin error will be thrown "SECURITY_ERR: DOM Exception 18"
        var canvas = document.createElement("canvas");
        canvas.width = imgElem.clientWidth;
        canvas.height = imgElem.clientHeight;
        var ctx = canvas.getContext("2d");
        ctx.drawImage(imgElem, 0, 0);
        var dataURL = canvas.toDataURL("image/png");
        return dataURL.replace(/^data:image\/(png|jpg);base64,/, "");
    }

    $("#Create").click(function () {
        var imgElem = document.getElementById('imgPreview');

        var photo = document.getElementById("photo");
        var file = photo.files[0];
        var date = new Date();
        var d = date.getDate();
        var m = date.getMonth();
        var y = date.getYear();
        var str = y.toString();
        var res = str.substring(1, 3);
        var date2 = d + "_" + m + "_" + res;
        alert(date2);
        FileName = date2 + file.name;
        alert(FileName);
        var imgData = getBase64Image(imgElem);
        var imgPath = ("../Picture/" + FileName);
        alert(imgData);
        var dataObject = {
            SerialNo: $("#txtSerialNo").val(), MachineNo: $("#txtMachineNo").val(), ProductType: $("#cmbProductType").find(":selected").val(), Brand: $("#txtBrand").val(),
            Size: $("#txtSize").val(), Model: $("#txtModel").val(), Lifetime: $("#txtLifetime").val(), ReceiveDate: $("#dtReceiveDate").val(),
            UnitWeight: $("#cmbUnitWeight").find(":selected").val(), Balance: $("#txtBalance").val(), Remain: $("#txtRemain").val(), Lost: $("#txtLost").val(), Repair: $("#txtRepair").val(),
            Break: $("#txtBreak").val(), Img: imgPath, ImgData: imgData, Remark: $("#txtRemark").val()
        };
        console.log(dataObject);
        $.ajax(
        {
            url: 'http://localhost:13131/api/Product',
            type: 'POST',
            data: dataObject,
            datatype: 'json',

            success: function (data) {
                alert('Created Successfully');
                window.location.href = "../ExpenseMaster/IndexExpenseMaster";
            },
            error: function (msg) { alert(msg); }
        });
    });
</script>
